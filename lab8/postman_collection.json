{
  "info": {
    "name": "Lab5 Social Network MVP",
    "_postman_id": "c0f1f1f4-9f2c-4e8a-9c9f-9c2b6c6c5d21",
    "description": "Postman collection for lab5 API tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "base_url", "value": "http://127.0.0.1:8000" },
    { "key": "token", "value": "" },
    { "key": "email", "value": "" },
    { "key": "password", "value": "" },
    { "key": "post_id", "value": "" },
    { "key": "comment_id", "value": "" }
  ],
  "item": [
    {
      "name": "Auth - Register",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const rand = Math.random().toString(16).slice(2, 10);",
              "pm.collectionVariables.set('email', `user_${rand}@example.com`);",
              "pm.collectionVariables.set('password', 'password123');",
              "pm.collectionVariables.set('name', `User ${rand}`);"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });",
              "const json = pm.response.json();",
              "pm.test('Token exists', function () { pm.expect(json.token).to.be.a('string'); });",
              "pm.collectionVariables.set('token', json.token);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"{{name}}\",\n  \"email\": \"{{email}}\",\n  \"password\": \"{{password}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/register",
          "host": ["{{base_url}}"],
          "path": ["auth", "register"]
        }
      }
    },
    {
      "name": "Auth - Login",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });",
              "const json = pm.response.json();",
              "pm.test('Token exists', function () { pm.expect(json.token).to.be.a('string'); });",
              "pm.collectionVariables.set('token', json.token);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{email}}\",\n  \"password\": \"{{password}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/login",
          "host": ["{{base_url}}"],
          "path": ["auth", "login"]
        }
      }
    },
    {
      "name": "Users - Me",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });",
              "const json = pm.response.json();",
              "pm.test('Email matches', function () { pm.expect(json.email).to.eql(pm.collectionVariables.get('email')); });"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": {
          "raw": "{{base_url}}/users/me",
          "host": ["{{base_url}}"],
          "path": ["users", "me"]
        }
      }
    },
    {
      "name": "Posts - Create",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });",
              "const json = pm.response.json();",
              "pm.test('Post id exists', function () { pm.expect(json.id).to.be.a('number'); });",
              "pm.collectionVariables.set('post_id', json.id);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            { "key": "text", "value": "Postman test post", "type": "text" }
          ]
        },
        "url": {
          "raw": "{{base_url}}/posts",
          "host": ["{{base_url}}"],
          "path": ["posts"]
        }
      }
    },
    {
      "name": "Feed - List",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });",
              "pm.test('Response is array', function () { pm.expect(pm.response.json()).to.be.an('array'); });"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": {
          "raw": "{{base_url}}/feed",
          "host": ["{{base_url}}"],
          "path": ["feed"]
        }
      }
    },
    {
      "name": "Posts - Detail",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });",
              "const json = pm.response.json();",
              "pm.test('Has post', function () { pm.expect(json.post).to.be.an('object'); });"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": {
          "raw": "{{base_url}}/posts/{{post_id}}",
          "host": ["{{base_url}}"],
          "path": ["posts", "{{post_id}}"]
        }
      }
    },
    {
      "name": "Posts - Like",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": {
          "raw": "{{base_url}}/posts/{{post_id}}/like",
          "host": ["{{base_url}}"],
          "path": ["posts", "{{post_id}}", "like"]
        }
      }
    },
    {
      "name": "Posts - Comment",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });",
              "const json = pm.response.json();",
              "pm.collectionVariables.set('comment_id', json.id);"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"text\": \"Postman comment\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/posts/{{post_id}}/comments",
          "host": ["{{base_url}}"],
          "path": ["posts", "{{post_id}}", "comments"]
        }
      }
    },
    {
      "name": "Posts - Unlike",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": {
          "raw": "{{base_url}}/posts/{{post_id}}/like",
          "host": ["{{base_url}}"],
          "path": ["posts", "{{post_id}}", "like"]
        }
      }
    },
    {
      "name": "Posts - Delete",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": {
          "raw": "{{base_url}}/posts/{{post_id}}",
          "host": ["{{base_url}}"],
          "path": ["posts", "{{post_id}}"]
        }
      }
    }
  ]
}
